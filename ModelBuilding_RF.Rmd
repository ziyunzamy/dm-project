---
title: "Data Mining Project"
author: "Amy Zheng"
date: "4/23/2017"
output: pdf_document
---

```{r}
rm(list=ls())
library(tidyverse)
library(devtools)


flights2015_over <- read.csv("flights2015_over.csv")
flights2015_over$DEP_DEL15 <- factor(flights2015_over$DEP_DEL15)
flights16_v_final <- read.csv("flights16_v_over.csv")
flights16_g <- read.csv("flights16_g_over.csv")

```


```{r}
#Make test set
set.seed(4)
idx = sample(1:nrow(flights2015_over),20000)
testing = flights2015_over[idx,]
training = flights2015_over[-idx,]
```



```{r}
library(randomForest)

# First RF. Fit on all data
forest = randomForest(DEP_DEL15 ~., data = training, ntree = 500, na.action = na.omit)
# Predictions on test/training in 2015 data set. 
yhat_test = predict(forest,newdata = testing)
yhat_train = predict(forest, newdata = training)
# Test error & Traning Error 
test_err = mean(yhat_test != testing$DEP_DEL15)
train_err = mean(yhat_train != training$DEP_DEL15)
# See Variable Importance
importance(forest)
varImpPlot(forest)

```


```{r}
# Fit RF with less variables based on varible importance
forest_sel= randomForest(DEP_DEL15 ~ CRS_DEP_TIME + CRS_ARR_TIME + delays.x + delays_2 + HDAYS + DAY_OF_MONTH +
                           SEASON + delays_des.x + delays_des_2 + CRS_ELAPSED_TIME + 
                           DAY_OF_WEEK + QUARTER + MONTH, 
                         data = training, ntree = 500, na.action = na.omit)

yhat_test_sel = predict(forest_sel,newdata = testing)
yhat_train_sel = predict(forest_sel, newdata = training)

test_err_sel = mean(yhat_test_sel != testing$DEP_DEL15)
train_err_sel = mean(yhat_train_sel != training$DEP_DEL15)

```



```{r}
# Test Model on 2016 data
ytest_16_test = predict(forest_sel,newdata = flights16_v_final)
test_err_sel_16 = mean(ytest_16_test != flights16_v_final$DEP_DEL15)
```

```{r}
y_16_guess = predict(forest_sel, newdata = flights16_g)
```
